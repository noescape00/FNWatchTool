@using WatchTool.Common.Models
@using WatchTool.Common.P2P.Payloads
@model WatchTool.Common.Models.PeersInformationModel

@{
    ViewData["Title"] = "WatchTool Dashboard";
}

<br />
<br />
<br />

<table class="table">
    <thead class="thead-dark">
    <tr>
        <th scope="col">#</th>
        <th scope="col">EndPoint</th>
        <th scope="col">Node Version</th>
        <th scope="col">Is running</th>
        <th scope="col">Info</th>
        <th scope="col">Actions</th>
    </tr>
    </thead>
    <tbody>
    @{
        for (int i = 0; i < Model.PeersInfo.Count; i++)
        {
            int rowNumber = i + 1;

            PeerInfoModel peer = Model.PeersInfo[i];

            string nodeVersion = "N/A";

            if (peer.LatestInfoPayload.IsNodeCloned)
            {
                NodeRepositoryVersionInfo repoInfo = peer.LatestInfoPayload.NodeRepoInfo;

                string hashShort = repoInfo.LatestCommitHash.Substring(0, 7);

                int daysOld = (int)(DateTime.Now - repoInfo.LatestCommitDate).TotalDays;

                nodeVersion = $"{hashShort} : {repoInfo.LatestCommitDate.ToShortDateString()} ({daysOld} days old)";
            }

            string runningInfo = "-";

            if (peer.LatestInfoPayload.IsNodeRunning)
            {
                RunningNodeInfo runningInfoModel = peer.LatestInfoPayload.RunningNodeInfo;

                runningInfo = $"height: {runningInfoModel.ConsensusHeight}";
            }

            <tr>
                <th scope="row">@rowNumber</th>
                <td>@peer.EndPoint</td>
                <td>@nodeVersion</td>
                <td>@peer.LatestInfoPayload.IsNodeRunning</td>
                <td>@runningInfo</td>
                <td>
                    ACTIONS
                </td>
            </tr>
        }
    }
    </tbody>
</table>
